<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.zerock.mapper.MountainMapper">


	<sql id="MCriteria">
		<where>
			<if test="keyword != null">
				mname LIKE '%' || #{keyword} || '%'
				OR mloc LIKE '%' || #{keyword} || '%'
			</if>
		</where>
	</sql>
	

	<select id="getTotalCount" resultType="int">
		SELECT count(*) FROM mountain
		<include refid="MCriteria"></include>
	</select>

	<insert id="insertSelectKey">
		<selectKey keyProperty="no" order="BEFORE" resultType="long">
			SELECT seq_mountain.nextval FROM dual
		</selectKey>

		INSERT INTO mountain (no, mname, mLoc, height, status, description)
		VALUES (#{no}, #{mname}, #{mloc}, #{height}, #{status}, #{description})
	</insert>

	<select id="read" resultType="org.zerock.domain.mountain.MountainVO">
		SELECT * FROM mountain WHERE no = #{no}
	</select>

	<update id="update">
		UPDATE mountain
		SET mname = #{mname, jdbcType = VARCHAR2},
			mloc = #{mloc},
			height = #{height},
			status = #{status},
			description = #{description}
		WHERE no = #{no}
	</update>

	<delete id="delete">
		DELETE FROM mountain WHERE no = #{no}
	</delete>

	<select id="getList" resultType="org.zerock.domain.mountain.MountainVO">
	<![CDATA[
		SELECT * FROM mountain WHERE no > 0
		ORDER BY no DESC
	]]>
	</select>

	<select id="getListWithPaging" resultType="org.zerock.domain.mountain.MountainVO">
	<![CDATA[
	SELECT no, mname, mloc, height, status, description
	FROM 
		(
		SELECT
			ROW_NUMBER() OVER (ORDER BY no DESC) rn,
			no, mname, mloc, height, status, description
		FROM 
			mountain
	]]>

		<include refid="MCriteria"></include>
	
	<![CDATA[
	 	)
	WHERE
		rn BETWEEN (#{curPage} - 1) * #{amount} + 1 AND #{curPage} * #{amount}
	]]>
	</select>

</mapper>	